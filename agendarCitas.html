<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Agendar cita</title>
  <link rel="stylesheet" href="./public/citas.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
</head>

<body>

  <div class="background-image">
    <img src="https://www.clinicasanpablo.co/galepages/mac_gal_citas_medicas_1549383405.jpg" alt="Imagen de fondo">
    <div class="contenedor">
      <h1>Agendar cita</h1>
      <form id="appointment-form">
        <div class="form-group">
          <div class="form-floating">
            <input type="text" class="form-control" id="patient.name" placeholder="name example" required>
            <label id="name" name="patient.name" for="floatingInput">Nombre</label>
          </div>
        </div>
        <div class="form-group">
          <div class="form-floating">
            <input type="text" class="form-control" id="patient.lastname" placeholder="name example" required>
            <label id="lastname" name="patient.lastname" for="floatingInput">Apellidos</label>
          </div>
        </div>
        <div class="form-group">
          <div class="form-floating">
            <input type="text" class="form-control" id="patient.dni" placeholder="00000-0000" required>
            <label id="dni" name="patient.dni" for="floatingInput">Numero de cedula</label>
          </div>
          <br>
          <div class="form-group">
            <div class="form-floating">
              <input type="text" class="form-control" id="patient.phone" placeholder="name@example.com" required>
              <label id="phone" name="patient.phone" for="floatingInput">Telefono</label>
            </div>
            <br>

            <div class="form-group">
              <label for="fecha">Fecha y hora</label>
              <input type="datetime-local" id="datehour" name="datehour" required>
            </div>

            <div class="form-group">
              <label for="especialidad">Especialidad</label>
              <select id="specialty" name="specialty" required>
                <option value="">Seleccione una opción</option>
                <option value="cardiología">Cardiología</option>
                <option value="dermatología">Dermatología</option>
                <option value="endocrinología">Endocrinología</option>
                <option value="gastroenterología">Gastroenterología</option>
                <option value="neurología">Neurología</option>
              </select>
            </div>

            <div class="form-group">
              <label for="doctor">Medico</label>
              <select id="doctor" name="doctor" required>
                <option value="">Seleccione una opción</option>
                <option value="Dr Ruiz">Dr Ruiz</option>
                <option value="Dr Chavez">Dr Chavez</option>
                <option value="Dr Navas">Dr Navas</option>
              </select>
            </div>
            <div class="Btn">
              <input id="button" type="submit" value="Agendar" />
              <!-- <button type="submit">Agendar</button> -->
            </div>
      </form>
    </div>

  </div>

  <script>
    const appointmentForm = document.getElementById('appointment-form');
    // Obtener el elemento HTML del formulario de citas por su ID y almacenarlo en la constante appointmentForm

    appointmentForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      // Agregar un event listener para el evento de enviar el formulario y prevenir el comportamiento predeterminado del evento (recargar la página)
      const patientName = document.getElementById('patient.name').value;
      const patientLastname = document.getElementById('patient.lastname').value;
      const patientDni = document.getElementById('patient.dni').value;
      const patientPhone = document.getElementById('patient.phone').value;
      const datehour = document.getElementById('datehour').value;
      const specialty = document.getElementById('specialty').value;
      const doctor = document.getElementById('doctor').value;
      // Obtener los valores de entrada del formulario para el nombre, apellido, DNI, teléfono, fecha y hora, especialidad y médico seleccionado, y almacenarlos en variables correspondientes
      const response = await fetch('https://api-clinica-sra.onrender.com/api/appointments', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          patient: {
            name: patientName,
            lastname: patientLastname,
            dni: patientDni,
            phone: patientPhone,
          },
          datehour,
          specialty,
          doctor,
        }),
      });
      // Hacer una solicitud HTTP POST a la API en la URL proporcionada, enviando los datos del paciente, la fecha y hora, la especialidad y el médico en formato JSON
      const responseData = await response.json();
      // Analizar la respuesta de la API y almacenarla en la variable responseData
      if (responseData.ok === 200) {
        alert('Cita agendada exitosamente');
        appointmentForm.reset();
      } else {
        alert('Ocurrió un error al agendar la cita');
      }
      // Comprobar si la respuesta de la API es exitosa (código de estado 200) y mostrar un mensaje de alerta correspondiente, además de restablecer el formulario. En caso contrario, mostrar un mensaje de error.
    });
  </script>
</body>

</html>