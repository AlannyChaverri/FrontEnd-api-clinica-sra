<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registrar Usuarios</title>
    <link rel="icon" href="/public/img/logo.png" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="./public/styles.css" />
  </head>

  <body>
    <section class="vh-100 banner gradient">
      <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
          <div class="col-12 col-md-8 col-lg-6 col-xl-5">
            <div
              class="card shadow-2-strong opacity-75"
              style="background-color: #b7b7b7; border-radius: 1rem"
            >
              <div class="card-body p-5 text-center">
                <div class="card-img">
                  <img
                    src="./public/img/logo.png"
                    alt="image"
                    width="20%"
                    height="20%"
                  />
                </div>

                <h3 class="mb-5">Usuarios</h3>

                <!-- User input -->
                <form id="user-form">
                  <div class="input-group mb-3">
                    <span class="input-group-text"
                      ><i class="bi bi-person" style="font-size: 1.5rem"></i
                    ></span>
                    <div class="form-floating">
                      <!-- ⏬⏬ SECAMBIAN LOS ID DE LOS <input> ⏬⏬ -->
                      <input
                        type="text"
                        class="form-control name"
                        name="name"
                        id="name"
                        placeholder="Carlos Gonzales"
                        required
                      />
                      <label for="floatingInput">Nombre</label>
                      <div class="invalid-feedback"></div>
                    </div>
                  </div>

                  <div class="input-group mb-3">
                    <span class="input-group-text"
                      ><i
                        class="bi bi-envelope-at"
                        style="font-size: 1.5rem"
                      ></i
                    ></span>
                    <div class="form-floating">
                      <!-- ⏬⏬ SECAMBIAN LOS ID DE LOS <input> ⏬⏬ -->
                      <input
                        type="email"
                        class="form-control name"
                        name="email"
                        id="email"
                        placeholder="email@ejemplo.com"
                        required
                      />
                      <label for="floatingInput">Correo Electronico</label>
                      <div class="invalid-feedback"></div>
                    </div>
                  </div>

                  <div class="input-group mb-3">
                    <span class="input-group-text"
                      ><i class="bi bi-lock" style="font-size: 1.5rem"></i
                    ></span>
                    <div class="form-floating">
                      <input
                        type="password"
                        class="form-control password"
                        name="password"
                        id="password"
                        placeholder="password"
                        required
                      />
                      <label for="floatingInput">Contraseña</label>
                    </div>
                  </div>

                  <!-- Checkbox -->
                  <div class="form-check d-flex justify-content-start mb-4">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      name="google"
                      id="google"
                    />
                    <label for="google">¿Es cuenta de Google?</label>

                    <input type="hidden" name="rol" id="rol" value="Public" />
                  </div>

                  <!--⏬⏬ se cambio el <button> por input ⏬⏬ -->
                  <!-- <button
                    class="btn btn-primary btn-lg btn-block"
                    type="submit"
                  >
                    Login
                  </button> -->

                  <input
                    class="btn btn-primary btn-lg btn-block"
                    type="submit"
                    value="Registrar"
                  />

                  <hr class="my-4" />

                  <a href="login.html">Volver al login</a>

                  <a href="#" class="text-reset text-decoration-none"> </a>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
      crossorigin="anonymous"
    ></script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      // Obtiene el formulario HTML con el ID "user-form" y lo asigna a una constante llamada "form"
      const form = document.getElementById("user-form");

      // Agrega un evento "submit" al formulario y define una función de callback que se ejecutará cuando se envíe el formulario
      form.addEventListener("submit", (e) => {
        // Evita el comportamiento predeterminado de enviar el formulario
        e.preventDefault();

        // Crea un objeto FormData a partir del formulario HTML
        const formData = new FormData(form);

        // Obtiene los valores de los campos del formulario y los asigna a constantes
        const name = formData.get("name");
        const email = formData.get("email");
        const password = formData.get("password");
        const google = formData.get("google") ? true : false;
        const rol = formData.get("rol");

        // Envía una solicitud POST a la API utilizando Axios y el objeto de datos obtenido del formulario
        axios
          .post("https://api-clinica-sra.onrender.com/api/users/", {
            name,
            email,
            password,
            google,
            rol,
          })
          .then((response) => {
            // Si la solicitud se completa con éxito, se muestra un mensaje de éxito y se restablece el formulario
            console.log(response.data);
            alert("Usuario registrado exitosamente.");
            form.reset();
          })
          .catch((error) => {
            // Si la solicitud falla, se muestra un mensaje de error en la consola y en una alerta
            console.error(error);
            alert("Error al registrar el usuario.");
          });
      });
    </script>
  </body>
</html>
